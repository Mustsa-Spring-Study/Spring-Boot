# 6주차

## 상품 도메인 개발

### 상품 엔티티 개발 (비즈니스 로직 추가)
- 비즈니스 로직
    - stock 증가
    - stock 감소 (남은 수량이 0보다 작으면 안됨)

### 상품 리포지토리 개발
- save()
  - item ID 값이 없음 => 새로 추가된 거임


## 주문 도메인 개발

### 주문, 주문상품 엔티티 개발
- 주문하는 순간 -> 재고 관리 돼야함
- 생성 메서드 만들어주기 (이렇게 해야 편리함)

- 비즈니스 로직
    - 주문 취소
      - 이미 배송된 상품 예외처리
      - orderItem -> cancel (재고수량 원래대로 늘리기)
- 조회 로직
    - 전체 주문 가격 -> orderItem 가서 count*price 

- 생성 메서드
    - 재고 줄이기

### 주문 서비스 개발
- 주문
  - 엔티티 조회: memberRepository에서 멤버 찾고 itemRepository에서 item 찾음
  - 배송정보 생성
  - 주문상품 생성
  - 주문 생성 / 저장

- 취소
  - 주문 엔티티 조회
  - 주문 취소

- 검색 (뒤에서...)

### 주문 기능 테스트
- 상품 주문
- 주문 취소
- 재고 수량 초과

- 실제로는 통합보다 단위 테스트 하는 게 더 좋긴 함...

### 주문 검색 기능 개발
- JPA에서 동적 쿼리 어떻게 해결? -> 동적 쿼리 사용하는 게 훨씬 효율적임
- (동적 쿼리: 파라미터에 따라 달라질 수 있는 쿼리)

- 값이 없으면? (null이면?) => 동적쿼리 해결 필요!
- ex. 상태값 없으면 상태체크 없이 다 들고와라 이런것들

- 1. JPQL로 처리
  - 일일이 문자 더하게 하는 코드 수동으로 작성해줘야... 
  - => 너무 번거로움

- 2. JPA Criteria
  - JPA에서 표준으로 제공
  - 실무에서 사용하기에 별로 (유지보수가 안됨)

- 3. Querydsl
  - 복잡한 정적쿼리도 이걸로 처리 가능
  - 자바 코드로 작성 -> 오류 잘 잡아줌



